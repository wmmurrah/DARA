{
    "contents" : "---\ntitle: \"CKCS Analyses\"\nauthor: \"William M. Murrah\"\ndate: '`r format(Sys.time(), \"%d %B, %Y\")`'\noutput: pdf_document\ncsl: apa.csl\nbibliography: tot2.bib\n---\n\n```{r opts, warning=FALSE, message=FALSE, echo=FALSE}\nlibrary(knitr)\nopts_knit$set(root.dir='../../../')\nopts_chunk$set(warning=FALSE, message=FALSE, echo=FALSE)\nlibrary(tables)\nlibrary(texreg)\nlibrary(tables)\nlibrary(Hmisc)\nlibrary(AER)\nlibrary(sandwich)\nlibrary(memisc)\n```\n\n\n```{r data}\nsource('data/core1Rmake.R')\nsource('analyses/core1ITT.R')\nsource('analyses/tslsModelsR1.R')\nsource('analyses/coreTSLScontinuous.R')\nsource('analyses/coreTSLScontinuousNA0.R')\nsource('analyses/tslsAEFP_1.R')\n\n```\n\n# Descriptives\n\n\\begin{table}[h]\n\\center\n```{r , results='asis'}\n# latex(\n#   tabular(Factor(lottery, \"Lottery\")  ~ Factor(tot.study,name = \"Study School Offer\", levelnames = c('Declined', 'Accepted')) + 1, core1)\n#   )\n\nlatex(\n  tabular(Factor(lottery, \"Lottery\")*((n=1) + Percent(denom=\"row\"))  + (Heading(\"Column Total\")*1 + Percent(denom=\"row\"))  ~ Factor(tot.study,name = \"Study School Offer\", levelnames = c('Declined', 'Accepted')) + (Heading(\"Row Total\")*1), core1)\n  )\n```\n\\caption{Crosstabulation of Lottery Offered and Lottery Accepted}\n\\end{table}\n\n\\begin{table}[h]\n\\center\n```{r , results='asis'}\nlatex(\n  tabular(Factor(lottery, \"Lottery\") + 1   ~ Factor(tot.study,name = \"Offer\", levelnames = c('Declined', 'Accepted'))*(school + 1) + (Total=1), core1)\n  )\n```\n\\caption{Crosstabulation of Lottery Offered and Lottery Accepted by Study School}\n\\end{table}\n\n\\begin{table}[h]\n\\center\n```{r , results='asis'}\nlatex(\n  tabular(Factor(lottery, \"Lottery\") * ((n=1) + Percent(denom=\"row\"))  + (Heading(\"Column Total\")*1 + Percent(denom=\"row\")) ~ Factor(tot.currentID, \"Study School 1st Grade\", c(\"Not Attended\", \"Attended\")) + (Heading(\"Row Total\")*1), core1)\n )\n```\n\\caption{Crosstabulation of Lottery Offered and Study School Attendance at the end of First Grade}\n\\end{table}\n\n\\begin{table}[h]\n\\center\n```{r , results='asis'}\nlatex(center = 'centering',\n  tabular(Factor(lottery, \"Lottery\") + 1   ~ Factor(tot.currentID, \"Study School 1st Grade\", c(\"Not Attended\", \"Attended\"))*(school + 1) + (Total=1), core1)\n  )\n```\n\\caption{Crosstabulation of Lottery Offered and Study School Attendance at the end of First Grade by Study School}\n\\end{table}\n\n\\newpage\n\n# Analyses\n\nThe primary models for the impact analyses were estimated using the students who applied to one study Core Knowledge charter school. By focusing on this subsample, we can assume one-sided noncompliance, meaning that there are no students who when not offered a placement in a study Core Knowledge charter school would accept a placement in a study Core knowledge charter school. Treatment assignment ($z$) was defined as a binary variable with '1' indicating that the student was offered a placement on one and only one of the study Core knowledge charter schools, and being '0' otherwise. Treatment receipt ($d$) was defined as a binary variable with '1' indicationg the student accepted a placement in one and only one study Core Knowledge charter schools and being '0' otherwise. The outcome variables ($y$) were the PPVT and Woodcock-Johnson scores described in the Methods section.\n\n\nThe $ITT_y$ is the intent-to-treat effect of treatment assignment ($z$) on the outcome ($y$). \n\n## $ITT_y:$\n\n$$\ny_i = \\beta_0 + \\beta_1 z_i + \\epsilon_i.\n$$\n\nThe $\\beta_1$ coefficient is interpreted as the effect of assignment to a study Core Knowledge charter school.\n\nThe $ITT_d$ is the reduced form or the first stage equation: \n\n## $ITT_d:$\n\n$$\nd_i = \\gamma_0 + \\gamma_1 z_i + \\nu_i.\n$$\n\nThe intercept ($\\gamma_0$) of this equation can be interpreted as the proportion of subjects who attended a study Core Knowledge charter school even though they were not offered a placement(e.g. Always-takers). Because we are assuming one-sided noncompliance, this value should be zero. The $\\gamma_1$ coefficient estimates the proportion of subjects who attend a study charter school in the event that they are offered a placement in a study charter school, minus the proportion that would attend a study charter school even if they would have been assigned to the control group [@gerber2012field]. Because we are assuming one-sided non-compliance, the $\\gamma_1$ can be interpreted as the proportion of subjects treated in the event that they are assigned to the treatment condition, which is the proportion of compliers.  \n\n\nConceputally, the $LATE_{y(d(z))}:$ is:\n\n$$\n \\delta = \\frac{\\beta_1}{\\gamma_1},\n$$ \n\nthe intent-to-treat effect divided by the proportion of compliers.\n\nComputationally, the $LATE_{y}$ is estimated by regressing the outcome on the predicted scores from the $ITT_d$ model as follows:\n \n## $LATE_{y}:$\n\n$$\ny_i = \\delta_0 + \\delta_1 \\hat{d}_i + \\upsilon_i,\n$$\n\nwhere $\\hat{\\delta_1}$ is:\n\n$$\n\\hat{d}_i = \\gamma_0 + \\gamma_1 z_i.\n$$\n\nWe use two-stage least squares regression to estimate this model.\n\n```{r ,results='asis', fig.pos=\"H\"}\nitt.d0 <- lm(tot.study ~ lottery + school, core1)\nitt.y  <- lm(scale(ppvt1) ~ lottery + school, core1)\nlate  <- ivreg(scale(ppvt1) ~ tot.study + school, ~ lottery + school, core1)\n# late2 <- ivreg(scale(ppvt1) ~ tot.study + school,  ~ \n#                  acsLottery + amaLottery + \n#                  lcaLottery + nvcLottery + praLottery + school,   \n#                core1)\nhc.d  <- coeftest(itt.d0, vcovHC(itt.d0))\nhc.y  <- coeftest(itt.y, vcovHC(itt.y))\nhc.late <- coeftest(late, vcovHC(late))\n# hc.late2 <- coeftest(late2, vcovHC(late2))\n# texreg(list(hc.d, hc.y, hc.late), custom.model.names = c('$ITT_d$', '$ITT_y$', '$LATE_{y(d(z))}$'), caption=\"PPVT\", custom.coef.names = c(\"(Intercept\", \"$z$\", \"Academy\", \"American\", \"Lincoln\", \"New Vision\", \"Platte River\", \"K full\", \"$d$\"),\n#        reorder.coef= c(1,2,9,3,4,5,6,7,8))\n# Without Robust SE.\ntexreg(list(itt.y, itt.d0, late), custom.model.names = c('$ITT_y$', '$ITT_d$', '$LATE_{y}$'), caption=\"PPVT\", custom.coef.names = c(\"(Intercept)\", \"$z$\", \"Academy\", \"American\", \"Lincoln\", \"New Vision\", \"Platte River\", \"$d$\"),\n       reorder.coef= c(1,2,8,3,4,5,6,7), float.pos='h')\n\n#  xtabs(~lottery + tot.study + school, core1)\n```\n\n\n```{r , results='asis' }\nitt.study <- \ntexreg(ckcs.itt, caption = \"Intent-to-treat analysis\")\n```\n\n\n\n```{r , results='asis' }\nitt.d <- lm(tot.study ~ lottery + school, core1)\ntot.cur <- core\nitt.d2 <- lm(as.numeric(tot.currentID)-1 ~ lottery + school, core1)\ntexreg(list(itt.d, itt.d2), caption = \"Reduced Form Equation\")\n```\n\n\n\n```{r , results='asis' }\ntexreg(ckcs.tot2, caption =\"Instrumental Variables estimation of Local Average Treatment Effect among the compliers\")\n```\n\n\n```{r , results='asis' }\ntexreg(ckcs.ak.itt, caption = \"Intent-to-treat analysis\")\n```\n\n```{r , results='asis' }\ntexreg(ckcs.ak.tot, caption =\"Instrumental Variables estimation of Local Average Treatment Effect among the compliers for Academic Knowledge subscales\")\n```\n\\newpage\n```{r2 ,results='asis', fig.pos=\"H\"}\n# itt.d0 <- lm(tot.study ~ lotteryOffer + school, core1)\n# itt.y  <- lm(scale(ppvt1) ~ lotteryOffer + school, core1)\n# late  <- ivreg(scale(ppvt1) ~ tot.study + school, ~ lotteryOffer + school, core1)\n# \n# hc.d  <- coeftest(itt.d0, vcovHC(itt.d0))\n# hc.y  <- coeftest(itt.y, vcovHC(itt.y))\n# hc.late <- coeftest(late, vcovHC(late))\n# hc.late2 <- coeftest(late2, vcovHC(late2))\n# # texreg(list(hc.d, hc.y, hc.late), custom.model.names = c('$ITT_d$', '$ITT_y$', '$LATE_{y}$'), caption=\"PPVT\", custom.coef.names = c(\"(Intercept\", \"$z$\", \"Academy\", \"American\", \"Lincoln\", \"New Vision\", \"Platte River\", \"K full\", \"$d$\"),\n# #        reorder.coef= c(1,2,9,3,4,5,6,7,8))\n# # Without Robust SE.\n# texreg(list(itt.y, itt.d0, late), custom.model.names = c('$ITT_y$', '$ITT_d$', '$LATE_{y}$'), caption=\"PPVT\", float.pos='h',\n#        reorder.coef= c(1,2,3,4,5,6,7,13,8,9,10,11,12))\n```\n\\newpage\n```{r3 ,results='asis', fig.pos=\"H\"}\n# itt.d0 <- lm(tot.study ~ lottery*school, core1)\n# itt.y  <- lm(scale(ppvt1) ~ lottery*school, core1)\n# late  <- ivreg(scale(ppvt1) ~ tot.study + school, ~ lottery*school, core1)\n# \n# hc.d  <- coeftest(itt.d0, vcovHC(itt.d0))\n# hc.y  <- coeftest(itt.y, vcovHC(itt.y))\n# hc.late <- coeftest(late, vcovHC(late))\n# hc.late2 <- coeftest(late2, vcovHC(late2))\n# # texreg(list(hc.d, hc.y, hc.late), custom.model.names = c('$ITT_d$', '$ITT_y$', '$LATE_{y}$'), caption=\"PPVT\", custom.coef.names = c(\"(Intercept)\", \"$z$\", \"Academy\", \"American\", \"Lincoln\", \"New Vision\", \"Platte River\", \"K full\", \"$d$\"),\n# #        reorder.coef= c(1,2,9,3,4,5,6,7,8))\n# # Without Robust SE.\n# texreg(list(itt.y, itt.d0, late), custom.model.names = c('$ITT_y$', '$ITT_d$', '$LATE_{y}$'), caption=\"PPVT\", float.pos='h',\n#        reorder.coef= c(1,2,3,4,5,6,7,13,8,9,10,11,12))\n```\n\n\n\\newpage\n\n\nTable \\ref{itt} contains the results from the intent-to-treat (ITT) analysis on students applying to one study charter school. The treatment variable in these analyses is `lotteryOffered`, and indicated whether or not the student was offered attendance in the one charter school applied to in the 2010-2011 school year. Table \\ref{tot1} contains the **two-stage least squares** analyses for the same sample of students using the variables created from the parent survey (`tot.ks.st`). Table \\ref{tot2} contains the **two-stage least squares** analyses using the dosage variable (`st.attend.2year`) from the enrollment data instead of the treatment receipt variable (`tot.ks.st`) created from the parent survey.\n\n```{r ,results='asis'}\n# texreg(ckcs.itt, caption='Intent-to-treat Analyses', label= 'itt')\n```\n\n\\pagebreak\n\n```{r ,results='asis', }\n# texreg(ckcs.tot2, caption='Treatment-on-the-treated Analyses', label = 'tot1')\n```\n\n\n```{r ,results='asis'}\n# texreg(ckcs.totNA0, caption='Treatment-on-the-treated Analyses with \"continuous\" dosage variable, all NAs converted to 0', label='tot2')\n```\n\n```{r ,results='asis'}\n# texreg(ckcs.tot, caption='Treatment-on-the-treated Analyses with \"continuous\" dosage variable')\n```\n\n\n\\pagebreak\n\n# References\n",
    "created" : 1424100793774.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3636047400",
    "id" : "BF47AFAC",
    "lastKnownWriteTime" : 1423847294,
    "path" : "~/FOCAL/CKCS/CoreTxAnalysis/reports/md/TOTanalyses2/tot2.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}